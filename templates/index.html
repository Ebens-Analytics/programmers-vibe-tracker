<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Programmer's Vibe Tracker</title>
<link rel="stylesheet" href="/static/style.css">
</head>
<body class="light-mode">
<div class="container">
    <h2>Programmer's Vibe Tracker</h2>

    <button id="themeToggle">Toggle Dark/Light Mode</button>

    <form id="vibeForm" method="POST">
        <label>Mood: <span id="moodVal">5</span></label>
        <div class="slider-container">
            <input type="range" name="mood" min="1" max="10" value="5" class="mood">
            <span class="tooltip" id="moodTooltip">5</span>
        </div>
        <p class="message" id="moodMsg"></p>

        <label>Energy: <span id="energyVal">5</span></label>
        <div class="slider-container">
            <input type="range" name="energy" min="1" max="10" value="5" class="energy">
            <span class="tooltip" id="energyTooltip">5</span>
        </div>
        <p class="message" id="energyMsg"></p>

        <label>Focus: <span id="focusVal">5</span></label>
        <div class="slider-container">
            <input type="range" name="focus" min="1" max="10" value="5" class="focus">
            <span class="tooltip" id="focusTooltip">5</span>
        </div>
        <p class="message" id="focusMsg"></p>

        <button type="submit">Save Vibe</button>
    </form>

    <p id="lowVibeMessage" style="display:none; font-weight:bold; margin-top:15px;">
        Time to take a break, coder! ðŸ˜´
    </p>
</div>

<script>

    let username = localStorage.getItem("username");
    if (!username) {
        username = prompt("Whatâ€™s your name?");
        localStorage.setItem("username", username);
    }
    
    document.querySelector("h2").textContent =
        "Welcome back, " + username + " ðŸ‘‹";
    // --- Theme Toggle ---
    const themeToggle = document.getElementById("themeToggle");
    const body = document.body;

    if(localStorage.getItem('theme')) {
        body.className = localStorage.getItem('theme');
    }

    themeToggle.addEventListener("click", () => {
        if(body.classList.contains("light-mode")) {
            body.classList.remove("light-mode");
            body.classList.add("dark-mode");
            localStorage.setItem('theme', 'dark-mode');
        } else {
            body.classList.remove("dark-mode");
            body.classList.add("light-mode");
            localStorage.setItem('theme', 'light-mode');
        }
    });

    // --- Slider & Vibe Messages ---
    const sliders = [
        {slider: document.querySelector(".mood"), val: document.getElementById("moodVal"), msg: document.getElementById("moodMsg"), tooltip: document.getElementById("moodTooltip")},
        {slider: document.querySelector(".energy"), val: document.getElementById("energyVal"), msg: document.getElementById("energyMsg"), tooltip: document.getElementById("energyTooltip")},
        {slider: document.querySelector(".focus"), val: document.getElementById("focusVal"), msg: document.getElementById("focusMsg"), tooltip: document.getElementById("focusTooltip")}
    ];

      function getMessage(value){
      if(value <= 3) return "Burnout warning ðŸš¨ Take a real break.";
      if(value <= 5) return "Low energy â€” hydrate, stretch, refocus.";
      if(value <= 7) return "Stable vibe. Keep the flow.";
      return "Peak performance ðŸ”¥ Youâ€™re in the zone!";
    }

    function updateTooltip(sliderObj){
        const slider = sliderObj.slider;
        const tooltip = sliderObj.tooltip;
        const percent = (slider.value - slider.min) / (slider.max - slider.min);
        const offset = percent * slider.offsetWidth;
        tooltip.style.left = offset + "px";
        tooltip.textContent = slider.value;
    }

    sliders.forEach(obj => {
        obj.val.textContent = obj.slider.value;
        obj.msg.textContent = getMessage(obj.slider.value);
        updateTooltip(obj);

        obj.slider.addEventListener("input", () => {
            obj.val.textContent = obj.slider.value;
            obj.msg.textContent = getMessage(obj.slider.value);
            updateTooltip(obj);
        });
    });

    // --- Low Vibe Detection ---
    const form = document.getElementById("vibeForm");
    const lowMsg = document.getElementById("lowVibeMessage");

    form.addEventListener("submit", function(e){
        const mood = parseInt(sliders[0].slider.value);
        const energy = parseInt(sliders[1].slider.value);
        const focus = parseInt(sliders[2].slider.value);
        const avg = (mood + energy + focus)/3;

        if(avg < 4){
            e.preventDefault();
            lowMsg.style.display = "block";
            setTimeout(() => form.submit(), 2000);
        }
    });
</script>
</body>
</html>